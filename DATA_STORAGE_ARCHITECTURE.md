# DelTran - ĞÑ€Ñ…Ğ¸Ñ‚ĞµĞºÑ‚ÑƒÑ€Ğ° Ğ¥Ñ€Ğ°Ğ½ĞµĞ½Ğ¸Ñ Ğ”Ğ°Ğ½Ğ½Ñ‹Ñ…

**Ğ”Ğ°Ñ‚Ğ°**: 2025-01-20
**Ğ¡Ñ‚Ğ°Ñ‚ÑƒÑ**: ğŸ“Š **ĞŸĞĞ›ĞĞĞ¯ ĞšĞĞ Ğ¢Ğ Ğ¥Ğ ĞĞĞ•ĞĞ˜Ğ¯**

---

## ğŸ—„ï¸ ĞĞ¢Ğ’Ğ•Ğ¢: ĞšÑƒĞ´Ğ° ÑĞ¾Ñ…Ñ€Ğ°Ğ½ÑÑÑ‚ÑÑ Ğ´Ğ°Ğ½Ğ½Ñ‹Ğµ?

DelTran Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞµÑ‚ **PostgreSQL** ĞºĞ°Ğº Ğ¾ÑĞ½Ğ¾Ğ²Ğ½Ğ¾Ğµ Ñ…Ñ€Ğ°Ğ½Ğ¸Ğ»Ğ¸Ñ‰Ğµ Ğ´Ğ»Ñ Ğ²ÑĞµÑ… ĞºÑ€Ğ¸Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ¸Ñ… Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…. ĞšĞ°Ğ¶Ğ´Ñ‹Ğ¹ Ğ¼Ğ¸ĞºÑ€Ğ¾ÑĞµÑ€Ğ²Ğ¸Ñ Ğ¸Ğ¼ĞµĞµÑ‚ ÑĞ²Ğ¾Ğ¸ ÑĞ¾Ğ±ÑÑ‚Ğ²ĞµĞ½Ğ½Ñ‹Ğµ Ñ‚Ğ°Ğ±Ğ»Ğ¸Ñ†Ñ‹, Ğ½Ğ¾ Ğ²ÑĞµ Ñ€Ğ°Ğ±Ğ¾Ñ‚Ğ°ÑÑ‚ Ñ **Ğ¾Ğ±Ñ‰ĞµĞ¹ Ğ±Ğ°Ğ·Ğ¾Ğ¹ Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…**.

### ĞÑ€Ñ…Ğ¸Ñ‚ĞµĞºÑ‚ÑƒÑ€Ğ° Ñ…Ñ€Ğ°Ğ½ĞµĞ½Ğ¸Ñ:

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   PostgreSQL (Ğ•Ğ´Ğ¸Ğ½Ğ°Ñ Ğ‘Ğ”)                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
â”‚  â”‚   Gateway    â”‚  â”‚  Obligation  â”‚  â”‚   Clearing   â”‚        â”‚
â”‚  â”‚   Tables     â”‚  â”‚   Tables     â”‚  â”‚   Tables     â”‚        â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
â”‚                                                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
â”‚  â”‚    Token     â”‚  â”‚     EMI      â”‚  â”‚   FX Rates   â”‚        â”‚
â”‚  â”‚   Tables     â”‚  â”‚   Accounts   â”‚  â”‚   Tables     â”‚        â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â†‘                    â†‘                    â†‘
           â”‚                    â”‚                    â”‚
    NATS Events          NATS Events          NATS Events
    (ÑÑ„ĞµĞ¼ĞµÑ€Ğ½Ñ‹Ğµ)          (ÑÑ„ĞµĞ¼ĞµÑ€Ğ½Ñ‹Ğµ)          (ÑÑ„ĞµĞ¼ĞµÑ€Ğ½Ñ‹Ğµ)
```

**Ğ’ĞĞ–ĞĞ**:
- âœ… **PostgreSQL** = Ğ¿Ğ¾ÑÑ‚Ğ¾ÑĞ½Ğ½Ğ¾Ğµ Ñ…Ñ€Ğ°Ğ½ĞµĞ½Ğ¸Ğµ (persistent)
- âœ… **NATS** = Ñ‚Ñ€Ğ°Ğ½ÑĞ¿Ğ¾Ñ€Ñ‚ ÑĞ¾Ğ±Ñ‹Ñ‚Ğ¸Ğ¹ (ephemeral, Ğ½Ğµ Ñ…Ñ€Ğ°Ğ½Ğ¸Ñ‚ Ğ´Ğ°Ğ½Ğ½Ñ‹Ğµ)
- âœ… ĞšĞ°Ğ¶Ğ´Ğ°Ñ Ñ‚Ñ€Ğ°Ğ½Ğ·Ğ°ĞºÑ†Ğ¸Ñ ÑĞ¾Ñ…Ñ€Ğ°Ğ½ÑĞµÑ‚ÑÑ Ğ² Ğ‘Ğ” **Ğ”Ğ** Ğ¿ÑƒĞ±Ğ»Ğ¸ĞºĞ°Ñ†Ğ¸Ğ¸ Ğ² NATS
- âœ… ĞŸĞ¾Ğ»Ğ½Ğ°Ñ Ğ¿Ñ€Ğ¾ÑĞ»ĞµĞ¶Ğ¸Ğ²Ğ°ĞµĞ¼Ğ¾ÑÑ‚ÑŒ Ñ‡ĞµÑ€ĞµĞ· database audit trail

---

## ğŸ“Š Ğ¢ĞĞ‘Ğ›Ğ˜Ğ¦Ğ« ĞŸĞ Ğ¡Ğ•Ğ Ğ’Ğ˜Ğ¡ĞĞœ

### 1ï¸âƒ£ Gateway Service

**Ğ¤Ğ°Ğ¹Ğ»**: `services/gateway-rust/migrations/20250118_001_create_payments_table.sql`

#### Ğ¢Ğ°Ğ±Ğ»Ğ¸Ñ†Ğ°: `payments`
**ĞĞ°Ğ·Ğ½Ğ°Ñ‡ĞµĞ½Ğ¸Ğµ**: Ğ¥Ñ€Ğ°Ğ½ĞµĞ½Ğ¸Ğµ Ğ²ÑĞµÑ… Ğ²Ñ…Ğ¾Ğ´ÑÑ‰Ğ¸Ñ… Ğ¿Ğ»Ğ°Ñ‚ĞµĞ¶ĞµĞ¹ Ğ² ĞºĞ°Ğ½Ğ¾Ğ½Ğ¸Ñ‡ĞµÑĞºĞ¾Ğ¹ Ñ„Ğ¾Ñ€Ğ¼Ğµ

```sql
CREATE TABLE payments (
    deltran_tx_id UUID PRIMARY KEY,           -- Ğ’Ğ½ÑƒÑ‚Ñ€ĞµĞ½Ğ½Ğ¸Ğ¹ ID DelTran
    obligation_id UUID,                       -- Ğ¡Ğ²ÑĞ·ÑŒ Ñ obligation
    uetr UUID,                                -- ISO 20022 UETR
    end_to_end_id VARCHAR(35) NOT NULL,       -- ISO 20022 E2E ID

    -- Ğ¡ÑƒĞ¼Ğ¼Ñ‹
    instructed_amount DECIMAL(18, 5) NOT NULL,
    settlement_amount DECIMAL(18, 5) NOT NULL,
    currency VARCHAR(3) NOT NULL,

    -- Ğ¡Ñ‚Ğ¾Ñ€Ğ¾Ğ½Ñ‹
    debtor_name VARCHAR(140),
    debtor_iban VARCHAR(34),
    creditor_name VARCHAR(140),
    creditor_iban VARCHAR(34),

    -- Ğ‘Ğ°Ğ½ĞºĞ¸
    debtor_agent_bic VARCHAR(11),
    creditor_agent_bic VARCHAR(11),

    -- Ğ¡Ñ‚Ğ°Ñ‚ÑƒÑ
    status VARCHAR(50) NOT NULL DEFAULT 'Received',

    -- Ğ¢Ğ°Ğ¹Ğ¼ÑÑ‚ĞµĞ¼Ğ¿Ñ‹
    created_at TIMESTAMP NOT NULL DEFAULT NOW(),
    funded_at TIMESTAMP,                      -- ĞšĞ¾Ğ³Ğ´Ğ° Ğ¿Ğ¾Ğ»ÑƒÑ‡ĞµĞ½ FIAT (camt.054)
    cleared_at TIMESTAMP,
    settled_at TIMESTAMP,
    completed_at TIMESTAMP,

    -- ĞœĞµÑ‚Ğ°Ğ´Ğ°Ğ½Ğ½Ñ‹Ğµ
    raw_iso_message TEXT,
    metadata JSONB DEFAULT '{}'
);
```

**Ğ˜Ğ½Ğ´ĞµĞºÑÑ‹**:
- `idx_payments_status` - Ğ±Ñ‹ÑÑ‚Ñ€Ñ‹Ğ¹ Ğ¿Ğ¾Ğ¸ÑĞº Ğ¿Ğ¾ ÑÑ‚Ğ°Ñ‚ÑƒÑÑƒ
- `idx_payments_end_to_end_id` - Ğ¿Ğ¾Ğ¸ÑĞº Ğ¿Ğ¾ E2E ID
- `idx_payments_pending_funding` - Ğ¼Ğ¾Ğ½Ğ¸Ñ‚Ğ¾Ñ€Ğ¸Ğ½Ğ³ Ğ¾Ğ¶Ğ¸Ğ´Ğ°ÑÑ‰Ğ¸Ñ… FIAT

#### Ğ¢Ğ°Ğ±Ğ»Ğ¸Ñ†Ğ°: `payment_events`
**ĞĞ°Ğ·Ğ½Ğ°Ñ‡ĞµĞ½Ğ¸Ğµ**: Audit trail Ğ²ÑĞµÑ… Ğ¸Ğ·Ğ¼ĞµĞ½ĞµĞ½Ğ¸Ğ¹ Ğ¿Ğ»Ğ°Ñ‚ĞµĞ¶Ğ°

```sql
CREATE TABLE payment_events (
    event_id UUID PRIMARY KEY,
    deltran_tx_id UUID NOT NULL REFERENCES payments(deltran_tx_id),
    event_type VARCHAR(50) NOT NULL,          -- 'RECEIVED', 'FUNDED', 'SETTLED'
    event_status VARCHAR(20) NOT NULL,
    event_data JSONB,
    created_at TIMESTAMP NOT NULL DEFAULT NOW()
);
```

**Ğ¤Ğ°Ğ¹Ğ» ĞºĞ¾Ğ´Ğ°**: [services/gateway-rust/src/db.rs](services/gateway-rust/src/db.rs)

---

### 2ï¸âƒ£ Obligation Engine

**Ğ¤Ğ°Ğ¹Ğ»**: Ğ˜ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞµÑ‚ Ğ¾Ğ±Ñ‰ÑƒÑ ÑÑ…ĞµĞ¼Ñƒ `infrastructure/database/migrations/001-initial-schema.sql`

#### Ğ¢Ğ°Ğ±Ğ»Ğ¸Ñ†Ğ°: `obligations`
**ĞĞ°Ğ·Ğ½Ğ°Ñ‡ĞµĞ½Ğ¸Ğµ**: ĞĞ±ÑĞ·Ğ°Ñ‚ĞµĞ»ÑŒÑÑ‚Ğ²Ğ° Ğ¿Ğ¾ Ğ¿Ğ»Ğ°Ñ‚ĞµĞ¶Ğ°Ğ¼

```sql
CREATE TABLE obligations (
    id UUID PRIMARY KEY,
    window_id BIGINT REFERENCES clearing_windows(id),
    transaction_id UUID,                      -- Ğ¡Ğ²ÑĞ·ÑŒ Ñ Ñ‚Ñ€Ğ°Ğ½Ğ·Ğ°ĞºÑ†Ğ¸ĞµĞ¹

    -- Ğ¡Ñ‚Ğ¾Ñ€Ğ¾Ğ½Ñ‹
    payer_id UUID NOT NULL REFERENCES banks(id),
    payee_id UUID NOT NULL REFERENCES banks(id),

    -- Ğ¡ÑƒĞ¼Ğ¼Ğ°
    amount NUMERIC(26,8) NOT NULL CHECK (amount > 0),
    currency VARCHAR(3) NOT NULL,

    -- Ğ¡Ñ‚Ğ°Ñ‚ÑƒÑ
    status VARCHAR(20) DEFAULT 'PENDING',     -- PENDING â†’ NETTED â†’ SETTLED
    obligation_type VARCHAR(50) DEFAULT 'TRANSACTION',
    priority INTEGER DEFAULT 1,

    -- ĞœĞµÑ‚Ğ°Ğ´Ğ°Ğ½Ğ½Ñ‹Ğµ
    metadata JSONB DEFAULT '{}',
    created_at TIMESTAMPTZ DEFAULT NOW(),
    processed_at TIMESTAMPTZ
);
```

**Ğ¡Ñ‚Ğ°Ñ‚ÑƒÑÑ‹ Obligation**:
```
PENDING   â†’ Ğ¡Ğ¾Ğ·Ğ´Ğ°Ğ½Ğ¾ Ğ¾Ğ±ÑĞ·Ğ°Ñ‚ĞµĞ»ÑŒÑÑ‚Ğ²Ğ¾
VALIDATED â†’ ĞŸÑ€Ğ¾ÑˆĞ»Ğ¾ compliance/risk
CLEARING  â†’ Ğ’ Ğ¾ĞºĞ½Ğµ ĞºĞ»Ğ¸Ñ€Ğ¸Ğ½Ğ³Ğ° (international Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾)
NETTED    â†’ Ğ£Ñ‡Ğ°ÑÑ‚Ğ²ÑƒĞµÑ‚ Ğ² netting
EXECUTING â†’ Settlement Ğ¾Ñ‚Ğ¿Ñ€Ğ°Ğ²Ğ¸Ğ» pacs.008
SETTLED   â†’ Ğ‘Ğ°Ğ½Ğº Ğ¿Ğ¾Ğ´Ñ‚Ğ²ĞµÑ€Ğ´Ğ¸Ğ» camt.054 âœ…
FAILED    â†’ ĞÑˆĞ¸Ğ±ĞºĞ°
```

**Ğ¤Ğ°Ğ¹Ğ» ĞºĞ¾Ğ´Ğ°**: [services/obligation-engine/src/database.rs](services/obligation-engine/src/database.rs) (uses shared schema)

---

### 3ï¸âƒ£ Clearing Engine

**Ğ¤Ğ°Ğ¹Ğ»**: `infrastructure/database/migrations/001-initial-schema.sql`

#### Ğ¢Ğ°Ğ±Ğ»Ğ¸Ñ†Ğ°: `clearing_windows`
**ĞĞ°Ğ·Ğ½Ğ°Ñ‡ĞµĞ½Ğ¸Ğµ**: ĞĞºĞ½Ğ° ĞºĞ»Ğ¸Ñ€Ğ¸Ğ½Ğ³Ğ° (6-Ñ‡Ğ°ÑĞ¾Ğ²Ñ‹Ğµ Ñ†Ğ¸ĞºĞ»Ñ‹)

```sql
CREATE TABLE clearing_windows (
    id BIGSERIAL PRIMARY KEY,
    window_name VARCHAR(100) UNIQUE NOT NULL,
    start_time TIMESTAMPTZ NOT NULL,
    end_time TIMESTAMPTZ NOT NULL,
    cutoff_time TIMESTAMPTZ NOT NULL,
    status VARCHAR(20) DEFAULT 'OPEN',        -- OPEN â†’ CLOSED â†’ PROCESSING â†’ COMPLETED
    region VARCHAR(50) DEFAULT 'Global',

    -- Ğ¡Ñ‚Ğ°Ñ‚Ğ¸ÑÑ‚Ğ¸ĞºĞ°
    transactions_count INTEGER DEFAULT 0,
    obligations_count INTEGER DEFAULT 0,
    total_gross_value NUMERIC(26,8) DEFAULT 0,
    total_net_value NUMERIC(26,8) DEFAULT 0,
    saved_amount NUMERIC(26,8) DEFAULT 0,     -- Ğ­ĞºĞ¾Ğ½Ğ¾Ğ¼Ğ¸Ñ Ğ¾Ñ‚ netting
    netting_efficiency NUMERIC(5,2) DEFAULT 0, -- %

    metadata JSONB DEFAULT '{}',
    created_at TIMESTAMPTZ DEFAULT NOW()
);
```

#### Ğ¢Ğ°Ğ±Ğ»Ğ¸Ñ†Ğ°: `net_positions`
**ĞĞ°Ğ·Ğ½Ğ°Ñ‡ĞµĞ½Ğ¸Ğµ**: Ğ ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚Ñ‹ multilateral netting

```sql
CREATE TABLE net_positions (
    id UUID PRIMARY KEY,
    window_id BIGINT NOT NULL REFERENCES clearing_windows(id),
    bank_pair_hash VARCHAR(100) NOT NULL,

    -- Ğ‘Ğ°Ğ½ĞºĞ¸
    bank_a_id UUID NOT NULL REFERENCES banks(id),
    bank_b_id UUID NOT NULL REFERENCES banks(id),
    currency VARCHAR(3) NOT NULL,

    -- Netting Ñ€ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚Ñ‹
    gross_debit_a_to_b NUMERIC(26,8) DEFAULT 0,
    gross_credit_b_to_a NUMERIC(26,8) DEFAULT 0,
    net_amount NUMERIC(26,8) DEFAULT 0,        -- Ğ¤Ğ¸Ğ½Ğ°Ğ»ÑŒĞ½Ğ°Ñ ÑÑƒĞ¼Ğ¼Ğ°
    net_direction VARCHAR(20),

    -- ĞœĞµÑ‚Ñ€Ğ¸ĞºĞ¸
    obligations_netted INTEGER DEFAULT 0,
    netting_ratio NUMERIC(5,4) DEFAULT 0,      -- Ğ­Ñ„Ñ„ĞµĞºÑ‚Ğ¸Ğ²Ğ½Ğ¾ÑÑ‚ÑŒ
    amount_saved NUMERIC(26,8) DEFAULT 0,      -- Ğ¡ÑĞºĞ¾Ğ½Ğ¾Ğ¼Ğ»ĞµĞ½Ğ¾ Ğ»Ğ¸ĞºĞ²Ğ¸Ğ´Ğ½Ğ¾ÑÑ‚Ğ¸

    created_at TIMESTAMPTZ DEFAULT NOW()
);
```

#### Ğ¢Ğ°Ğ±Ğ»Ğ¸Ñ†Ğ°: `settlement_instructions`
**ĞĞ°Ğ·Ğ½Ğ°Ñ‡ĞµĞ½Ğ¸Ğµ**: Ğ˜Ğ½ÑÑ‚Ñ€ÑƒĞºÑ†Ğ¸Ğ¸ Ğ´Ğ»Ñ Settlement Engine

```sql
CREATE TABLE settlement_instructions (
    id UUID PRIMARY KEY,
    window_id BIGINT NOT NULL REFERENCES clearing_windows(id),
    net_position_id UUID REFERENCES net_positions(id),

    -- ĞŸĞ»Ğ°Ñ‚ĞµĞ¶
    payer_bank_id UUID NOT NULL REFERENCES banks(id),
    payee_bank_id UUID NOT NULL REFERENCES banks(id),
    amount NUMERIC(26,8) NOT NULL,
    currency VARCHAR(3) NOT NULL,

    -- Ğ˜ÑĞ¿Ğ¾Ğ»Ğ½ĞµĞ½Ğ¸Ğµ
    instruction_type VARCHAR(50) DEFAULT 'NET_SETTLEMENT',
    status VARCHAR(20) DEFAULT 'PENDING',
    deadline TIMESTAMPTZ NOT NULL,
    sent_to_settlement_at TIMESTAMPTZ,
    settlement_id UUID,

    created_at TIMESTAMPTZ DEFAULT NOW()
);
```

**Ğ¤Ğ°Ğ¹Ğ» ĞºĞ¾Ğ´Ğ°**: [services/clearing-engine/src/database.rs](services/clearing-engine/src/database.rs)

---

### 4ï¸âƒ£ Token Engine

**Ğ¤Ğ°Ğ¹Ğ»**: Ğ¡Ğ¾Ğ±ÑÑ‚Ğ²ĞµĞ½Ğ½Ñ‹Ğµ Ñ‚Ğ°Ğ±Ğ»Ğ¸Ñ†Ñ‹ (Ğ½Ğµ Ğ½Ğ°Ğ¹Ğ´ĞµĞ½Ğ° Ğ¼Ğ¸Ğ³Ñ€Ğ°Ñ†Ğ¸Ñ, Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞµÑ‚ÑÑ ORM)

#### Ğ¢Ğ°Ğ±Ğ»Ğ¸Ñ†Ğ°: `tokens`
**ĞĞ°Ğ·Ğ½Ğ°Ñ‡ĞµĞ½Ğ¸Ğµ**: Ğ¢Ğ¾ĞºĞµĞ½Ğ¸Ğ·Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ½Ñ‹Ğµ Ğ°ĞºÑ‚Ğ¸Ğ²Ñ‹ (xAED, xUSD, xILS)

```sql
CREATE TABLE tokens (
    id UUID PRIMARY KEY,
    currency VARCHAR(3) NOT NULL,             -- xAED, xUSD, xILS
    amount NUMERIC(26,8) NOT NULL,
    bank_id UUID NOT NULL REFERENCES banks(id),

    -- Ğ¡Ñ‚Ğ°Ñ‚ÑƒÑ
    status VARCHAR(20) DEFAULT 'ACTIVE',      -- ACTIVE, LOCKED, BURNED

    -- ĞŸÑ€Ğ¸Ğ²ÑĞ·ĞºĞ° Ğº Ñ€ĞµĞ°Ğ»ÑŒĞ½Ğ¾Ğ¼Ñƒ FIAT
    clearing_window BIGINT,
    reference VARCHAR(255),                   -- Ğ¡ÑÑ‹Ğ»ĞºĞ° Ğ½Ğ° camt.054 entry

    -- Ğ¢Ğ°Ğ¹Ğ¼ÑÑ‚ĞµĞ¼Ğ¿Ñ‹
    created_at TIMESTAMPTZ NOT NULL,
    burned_at TIMESTAMPTZ
);
```

**Ğ“Ğ°Ñ€Ğ°Ğ½Ñ‚Ğ¸Ñ 1:1 backing**:
- Ğ¢Ğ¾ĞºĞµĞ½ ÑĞ¾Ğ·Ğ´Ğ°ĞµÑ‚ÑÑ Ğ¢ĞĞ›Ğ¬ĞšĞ Ğ¿Ğ¾ÑĞ»Ğµ `camt.054 BOOKED` confirmation
- `reference` ÑĞ¾Ğ´ĞµÑ€Ğ¶Ğ¸Ñ‚ bank transaction ID
- ĞĞµĞ²Ğ¾Ğ·Ğ¼Ğ¾Ğ¶Ğ½Ğ¾ ÑĞ¾Ğ·Ğ´Ğ°Ñ‚ÑŒ Ñ‚Ğ¾ĞºĞµĞ½ Ğ±ĞµĞ· Ñ€ĞµĞ°Ğ»ÑŒĞ½Ğ¾Ğ³Ğ¾ FIAT

**Ğ¤Ğ°Ğ¹Ğ» ĞºĞ¾Ğ´Ğ°**: [services/token-engine/src/database.rs](services/token-engine/src/database.rs)

---

### 5ï¸âƒ£ EMI Accounts (E-Money Institution)

**Ğ¤Ğ°Ğ¹Ğ»**: `infrastructure/database/migrations/002-emi-accounts.sql`

#### Ğ¢Ğ°Ğ±Ğ»Ğ¸Ñ†Ğ°: `emi_accounts`
**ĞĞ°Ğ·Ğ½Ğ°Ñ‡ĞµĞ½Ğ¸Ğµ**: Ğ¡Ñ‡ĞµÑ‚Ğ° Ğ² Ğ±Ğ°Ğ½ĞºĞ°Ñ…-ĞºĞ¾Ñ€Ñ€ĞµÑĞ¿Ğ¾Ğ½Ğ´ĞµĞ½Ñ‚Ğ°Ñ… Ğ´Ğ»Ñ Ñ…Ñ€Ğ°Ğ½ĞµĞ½Ğ¸Ñ FIAT

```sql
CREATE TABLE emi_accounts (
    id UUID PRIMARY KEY,
    bank_id UUID NOT NULL REFERENCES banks(id),
    account_number VARCHAR(50) NOT NULL,
    iban VARCHAR(34),
    swift_bic VARCHAR(11),
    currency VARCHAR(3) NOT NULL,
    country_code VARCHAR(3) NOT NULL,

    -- Ğ¢Ğ¸Ğ¿ ÑÑ‡ĞµÑ‚Ğ°
    account_type VARCHAR(20) NOT NULL DEFAULT 'client_funds',

    -- Ğ‘Ğ°Ğ»Ğ°Ğ½ÑÑ‹ (Ğ² Ğ²Ğ°Ğ»ÑÑ‚Ğµ ÑÑ‡ĞµÑ‚Ğ°)
    ledger_balance NUMERIC(26,8) DEFAULT 0,          -- Ğ’Ğ½ÑƒÑ‚Ñ€ĞµĞ½Ğ½Ğ¸Ğ¹ Ğ±Ğ°Ğ»Ğ°Ğ½Ñ
    bank_reported_balance NUMERIC(26,8) DEFAULT 0,   -- Ğ‘Ğ°Ğ»Ğ°Ğ½Ñ Ğ¾Ñ‚ Ğ±Ğ°Ğ½ĞºĞ°
    reserved_balance NUMERIC(26,8) DEFAULT 0,        -- Ğ—Ğ°Ñ€ĞµĞ·ĞµÑ€Ğ²Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¾
    available_balance NUMERIC(26,8) AS (ledger_balance - reserved_balance),

    -- Reconciliation
    last_reconciliation_at TIMESTAMPTZ,
    reconciliation_status VARCHAR(20) DEFAULT 'PENDING',
    reconciliation_source VARCHAR(50),               -- 'camt.053', 'camt.054'
    reconciliation_difference NUMERIC(26,8) DEFAULT 0,

    created_at TIMESTAMPTZ DEFAULT NOW(),
    updated_at TIMESTAMPTZ DEFAULT NOW()
);
```

#### Ğ¢Ğ°Ğ±Ğ»Ğ¸Ñ†Ğ°: `emi_transactions`
**ĞĞ°Ğ·Ğ½Ğ°Ñ‡ĞµĞ½Ğ¸Ğµ**: Ğ’ÑĞµ Ğ´Ğ²Ğ¸Ğ¶ĞµĞ½Ğ¸Ñ Ğ½Ğ° EMI ÑÑ‡ĞµÑ‚Ğ°Ñ…

```sql
CREATE TABLE emi_transactions (
    id UUID PRIMARY KEY,
    account_id UUID NOT NULL REFERENCES emi_accounts(id),

    -- Ğ¢Ğ¸Ğ¿ Ñ‚Ñ€Ğ°Ğ½Ğ·Ğ°ĞºÑ†Ğ¸Ğ¸
    transaction_type VARCHAR(30) NOT NULL,    -- 'funding', 'settlement', 'fee'
    direction VARCHAR(10) NOT NULL,           -- 'CREDIT', 'DEBIT'
    amount NUMERIC(26,8) NOT NULL,

    -- Ğ‘Ğ°Ğ»Ğ°Ğ½ÑÑ‹
    balance_before NUMERIC(26,8) NOT NULL,
    balance_after NUMERIC(26,8) NOT NULL,

    -- Ğ¡Ğ²ÑĞ·Ğ¸
    related_transaction_id UUID,              -- DelTran payment
    related_settlement_id UUID,
    bank_reference VARCHAR(100),              -- Bank's txn ID
    uetr VARCHAR(36),                         -- ISO 20022 UETR

    -- ISO 20022
    iso_message_type VARCHAR(20),             -- 'pacs.008', 'camt.054'
    iso_message_id VARCHAR(35),

    -- Ğ¡Ñ‚Ğ°Ñ‚ÑƒÑ
    status VARCHAR(20) DEFAULT 'PENDING',     -- PENDING, CONFIRMED, FAILED
    confirmed_at TIMESTAMPTZ,

    created_at TIMESTAMPTZ DEFAULT NOW()
);
```

#### Ğ¢Ğ°Ğ±Ğ»Ğ¸Ñ†Ğ°: `emi_account_snapshots`
**ĞĞ°Ğ·Ğ½Ğ°Ñ‡ĞµĞ½Ğ¸Ğµ**: EOD (End-of-Day) ÑĞ½Ğ¸Ğ¼ĞºĞ¸ Ğ´Ğ»Ñ Ñ€ĞµĞ³ÑƒĞ»ÑÑ‚Ğ¾Ñ€Ğ¾Ğ²

```sql
CREATE TABLE emi_account_snapshots (
    id UUID PRIMARY KEY,
    account_id UUID NOT NULL REFERENCES emi_accounts(id),
    snapshot_date DATE NOT NULL,
    snapshot_time TIMESTAMPTZ NOT NULL,

    ledger_balance NUMERIC(26,8) NOT NULL,
    bank_reported_balance NUMERIC(26,8) NOT NULL,
    reserved_balance NUMERIC(26,8) NOT NULL,
    available_balance NUMERIC(26,8) NOT NULL,

    difference NUMERIC(26,8) DEFAULT 0,
    reconciled BOOLEAN DEFAULT FALSE,

    statement_reference VARCHAR(100),         -- camt.053 reference

    UNIQUE(account_id, snapshot_date)
);
```

---

### 6ï¸âƒ£ Account Monitor Service

**Ğ¤Ğ°Ğ¹Ğ»**: `services/account-monitor/migrations/001_create_funding_events.sql`

#### Ğ¢Ğ°Ğ±Ğ»Ğ¸Ñ†Ğ°: `funding_events`
**ĞĞ°Ğ·Ğ½Ğ°Ñ‡ĞµĞ½Ğ¸Ğµ**: ĞŸĞ¾Ğ´Ñ‚Ğ²ĞµÑ€Ğ¶Ğ´ĞµĞ½Ğ½Ñ‹Ğµ ÑĞ¾Ğ±Ñ‹Ñ‚Ğ¸Ñ Ğ¿Ğ¾ÑÑ‚ÑƒĞ¿Ğ»ĞµĞ½Ğ¸Ñ FIAT

```sql
CREATE TABLE funding_events (
    id UUID PRIMARY KEY,
    payment_id UUID NOT NULL,
    transaction_id VARCHAR(255) NOT NULL UNIQUE,
    account_id VARCHAR(100) NOT NULL,
    amount DECIMAL(20, 4) NOT NULL,
    currency VARCHAR(3) NOT NULL,
    end_to_end_id VARCHAR(255),
    debtor_name VARCHAR(255),
    debtor_account VARCHAR(100),
    booking_date TIMESTAMP,
    value_date TIMESTAMP,
    confirmed_at TIMESTAMP NOT NULL DEFAULT NOW(),
    created_at TIMESTAMP NOT NULL DEFAULT NOW()
);
```

**ĞĞ°Ğ·Ğ½Ğ°Ñ‡ĞµĞ½Ğ¸Ğµ**:
- Ğ¥Ñ€Ğ°Ğ½Ğ¸Ñ‚ ÑĞ¾Ğ±Ñ‹Ñ‚Ğ¸Ñ "Ğ´ĞµĞ½ÑŒĞ³Ğ¸ Ñ€ĞµĞ°Ğ»ÑŒĞ½Ğ¾ Ğ·Ğ°Ñ‡Ğ¸ÑĞ»ĞµĞ½Ñ‹"
- Ğ¢Ñ€Ğ¸Ğ³Ğ³ĞµÑ€Ğ¸Ñ‚ Token Engine Ğ´Ğ»Ñ Ğ¼Ğ¸Ğ½Ñ‚Ğ¸Ğ½Ğ³Ğ°
- Ğ˜ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞµÑ‚ÑÑ Ğ´Ğ»Ñ reconciliation

#### Ğ¢Ğ°Ğ±Ğ»Ğ¸Ñ†Ğ°: `unmatched_transactions`
**ĞĞ°Ğ·Ğ½Ğ°Ñ‡ĞµĞ½Ğ¸Ğµ**: Ğ¢Ñ€Ğ°Ğ½Ğ·Ğ°ĞºÑ†Ğ¸Ğ¸ Ğ±ĞµĞ· ÑĞ¾Ğ¾Ñ‚Ğ²ĞµÑ‚ÑÑ‚Ğ²ÑƒÑÑ‰ĞµĞ³Ğ¾ payment

```sql
CREATE TABLE unmatched_transactions (
    id UUID PRIMARY KEY,
    transaction_id VARCHAR(255) NOT NULL UNIQUE,
    account_id VARCHAR(100) NOT NULL,
    amount DECIMAL(20, 4) NOT NULL,
    currency VARCHAR(3) NOT NULL,
    debtor_name VARCHAR(255),
    debtor_account VARCHAR(100),
    booking_date TIMESTAMP,
    value_date TIMESTAMP,
    detected_at TIMESTAMP NOT NULL DEFAULT NOW(),
    status VARCHAR(20) DEFAULT 'UNMATCHED',   -- UNMATCHED, INVESTIGATING, RESOLVED
    resolution_notes TEXT,
    created_at TIMESTAMP NOT NULL DEFAULT NOW()
);
```

**Ğ¤Ğ°Ğ¹Ğ»**: `services/account-monitor/migrations/002_create_unmatched_transactions.sql`

---

### 7ï¸âƒ£ Risk Engine

**Ğ¤Ğ°Ğ¹Ğ»**: `infrastructure/database/migrations/003-fx-rates-historical.sql`

#### Ğ¢Ğ°Ğ±Ğ»Ğ¸Ñ†Ğ°: `fx_rate_ticks`
**ĞĞ°Ğ·Ğ½Ğ°Ñ‡ĞµĞ½Ğ¸Ğµ**: Intraday ĞºÑƒÑ€ÑÑ‹ Ğ²Ğ°Ğ»ÑÑ‚ Ğ´Ğ»Ñ real-time Ğ¼Ğ¾Ğ½Ğ¸Ñ‚Ğ¾Ñ€Ğ¸Ğ½Ğ³Ğ°

```sql
CREATE TABLE fx_rate_ticks (
    id BIGSERIAL PRIMARY KEY,
    currency_pair VARCHAR(7) NOT NULL,        -- USD/AED, EUR/USD
    base_currency VARCHAR(3) NOT NULL,
    quote_currency VARCHAR(3) NOT NULL,

    -- Ğ¦ĞµĞ½Ñ‹ (8 Ğ·Ğ½Ğ°ĞºĞ¾Ğ² Ğ¿Ğ¾ÑĞ»Ğµ Ğ·Ğ°Ğ¿ÑÑ‚Ğ¾Ğ¹ Ğ´Ğ»Ñ FX)
    bid_price NUMERIC(26,8) NOT NULL,
    ask_price NUMERIC(26,8) NOT NULL,
    mid_price NUMERIC(26,8) AS ((bid_price + ask_price) / 2),
    spread NUMERIC(26,8) AS (ask_price - bid_price),

    -- ĞĞ±ÑŠĞµĞ¼ Ğ¸ Ğ»Ğ¸ĞºĞ²Ğ¸Ğ´Ğ½Ğ¾ÑÑ‚ÑŒ
    volume NUMERIC(26,8) DEFAULT 0,
    liquidity_score NUMERIC(5,2),             -- 0-100

    -- Ğ’Ñ€ĞµĞ¼Ñ
    tick_timestamp TIMESTAMPTZ NOT NULL,
    market_session VARCHAR(20),               -- ASIAN, EUROPEAN, AMERICAN

    source VARCHAR(50),                       -- HISTORICAL, LIVE, SIMULATED

    UNIQUE (currency_pair, tick_timestamp)
);
```

#### Ğ¢Ğ°Ğ±Ğ»Ğ¸Ñ†Ğ°: `fx_rate_daily`
**ĞĞ°Ğ·Ğ½Ğ°Ñ‡ĞµĞ½Ğ¸Ğµ**: Ğ”Ğ½ĞµĞ²Ğ½Ñ‹Ğµ OHLC (Open, High, Low, Close) Ğ´Ğ°Ğ½Ğ½Ñ‹Ğµ

```sql
CREATE TABLE fx_rate_daily (
    id BIGSERIAL PRIMARY KEY,
    currency_pair VARCHAR(7) NOT NULL,
    trade_date DATE NOT NULL,

    -- OHLC
    open_price NUMERIC(26,8) NOT NULL,
    high_price NUMERIC(26,8) NOT NULL,
    low_price NUMERIC(26,8) NOT NULL,
    close_price NUMERIC(26,8) NOT NULL,

    daily_volume NUMERIC(26,8) DEFAULT 0,

    -- Ğ¡Ñ‚Ğ°Ñ‚Ğ¸ÑÑ‚Ğ¸ĞºĞ°
    daily_volatility NUMERIC(10,6),           -- Ğ¡Ñ‚Ğ°Ğ½Ğ´Ğ°Ñ€Ñ‚Ğ½Ğ¾Ğµ Ğ¾Ñ‚ĞºĞ»Ğ¾Ğ½ĞµĞ½Ğ¸Ğµ
    daily_return NUMERIC(10,6),               -- % Ğ¸Ğ·Ğ¼ĞµĞ½ĞµĞ½Ğ¸Ğµ

    -- Moving averages (Ğ¿Ñ€ĞµĞ´Ñ€Ğ°ÑÑÑ‡Ğ¸Ñ‚Ğ°Ğ½Ñ‹)
    sma_7 NUMERIC(26,8),                      -- 7-day SMA
    sma_30 NUMERIC(26,8),                     -- 30-day SMA
    sma_90 NUMERIC(26,8),                     -- 90-day SMA

    UNIQUE (currency_pair, trade_date)
);
```

#### Ğ¢Ğ°Ğ±Ğ»Ğ¸Ñ†Ğ°: `fx_rate_volatility`
**ĞĞ°Ğ·Ğ½Ğ°Ñ‡ĞµĞ½Ğ¸Ğµ**: ĞœĞµÑ‚Ñ€Ğ¸ĞºĞ¸ Ğ²Ğ¾Ğ»Ğ°Ñ‚Ğ¸Ğ»ÑŒĞ½Ğ¾ÑÑ‚Ğ¸ Ğ´Ğ»Ñ Ñ€Ğ°ÑÑ‡ĞµÑ‚Ğ° Ñ€Ğ¸ÑĞºĞ¾Ğ²

```sql
CREATE TABLE fx_rate_volatility (
    id BIGSERIAL PRIMARY KEY,
    currency_pair VARCHAR(7) NOT NULL,
    calculation_date DATE NOT NULL,

    -- Ğ’Ğ¾Ğ»Ğ°Ñ‚Ğ¸Ğ»ÑŒĞ½Ğ¾ÑÑ‚ÑŒ (annualized %)
    volatility_1d NUMERIC(10,6),              -- 1-day
    volatility_7d NUMERIC(10,6),              -- 7-day
    volatility_30d NUMERIC(10,6),             -- 30-day
    volatility_90d NUMERIC(10,6),             -- 90-day
    volatility_365d NUMERIC(10,6),            -- 1-year

    -- VaR (Value at Risk)
    var_95_1d NUMERIC(10,6),                  -- 95% confidence, 1-day
    var_99_1d NUMERIC(10,6),                  -- 99% confidence, 1-day

    -- Stress scenarios
    max_drawdown_30d NUMERIC(10,6),           -- Max Ğ¿Ğ°Ğ´ĞµĞ½Ğ¸Ğµ Ğ·Ğ° 30 Ğ´Ğ½ĞµĞ¹
    max_surge_30d NUMERIC(10,6),              -- Max Ñ€Ğ¾ÑÑ‚ Ğ·Ğ° 30 Ğ´Ğ½ĞµĞ¹

    UNIQUE (currency_pair, calculation_date)
);
```

#### Ğ¢Ğ°Ğ±Ğ»Ğ¸Ñ†Ğ°: `fx_currency_pairs`
**ĞĞ°Ğ·Ğ½Ğ°Ñ‡ĞµĞ½Ğ¸Ğµ**: ĞšĞ¾Ğ½Ñ„Ğ¸Ğ³ÑƒÑ€Ğ°Ñ†Ğ¸Ñ Ğ²Ğ°Ğ»ÑÑ‚Ğ½Ñ‹Ñ… Ğ¿Ğ°Ñ€

```sql
CREATE TABLE fx_currency_pairs (
    id SERIAL PRIMARY KEY,
    currency_pair VARCHAR(7) UNIQUE NOT NULL,
    base_currency VARCHAR(3) NOT NULL,
    quote_currency VARCHAR(3) NOT NULL,

    -- Trading Ğ¿Ğ°Ñ€Ğ°Ğ¼ĞµÑ‚Ñ€Ñ‹
    is_active BOOLEAN DEFAULT TRUE,
    min_trade_size NUMERIC(26,8),
    max_trade_size NUMERIC(26,8),

    -- Risk Ğ¿Ğ°Ñ€Ğ°Ğ¼ĞµÑ‚Ñ€Ñ‹
    max_exposure_usd NUMERIC(26,8),           -- Max exposure Ğ² USD
    alert_threshold NUMERIC(10,6),            -- % move â†’ alert
    circuit_breaker_threshold NUMERIC(10,6),  -- % move â†’ halt

    -- Ğ¥Ğ°Ñ€Ğ°ĞºÑ‚ĞµÑ€Ğ¸ÑÑ‚Ğ¸ĞºĞ¸ Ñ€Ñ‹Ğ½ĞºĞ°
    typical_spread_bps NUMERIC(10,2),         -- Spread Ğ² basis points
    average_daily_volume NUMERIC(26,8),
    market_depth_score NUMERIC(5,2)           -- 0-100
);
```

**ĞŸÑ€ĞµĞ´Ğ·Ğ°Ğ³Ñ€ÑƒĞ¶ĞµĞ½Ğ½Ñ‹Ğµ Ğ¿Ğ°Ñ€Ñ‹**:
- USD/AED, USD/INR, EUR/USD, GBP/USD (major)
- EUR/AED, GBP/AED, EUR/INR, GBP/INR (cross)
- AED/INR, SAR/INR (exotic - DelTran corridors)

**Ğ¤Ğ°Ğ¹Ğ» ĞºĞ¾Ğ´Ğ°**: [services/risk-engine/src/database.rs](services/risk-engine/src/database.rs) (simple pool only)

---

### 8ï¸âƒ£ Banks Directory

**Ğ¤Ğ°Ğ¹Ğ»**: `infrastructure/database/migrations/001-initial-schema.sql`

#### Ğ¢Ğ°Ğ±Ğ»Ğ¸Ñ†Ğ°: `banks`
**ĞĞ°Ğ·Ğ½Ğ°Ñ‡ĞµĞ½Ğ¸Ğµ**: Ğ¡Ğ¿Ñ€Ğ°Ğ²Ğ¾Ñ‡Ğ½Ğ¸Ğº Ğ±Ğ°Ğ½ĞºĞ¾Ğ²-ÑƒÑ‡Ğ°ÑÑ‚Ğ½Ğ¸ĞºĞ¾Ğ²

```sql
CREATE TABLE banks (
    id UUID PRIMARY KEY,
    bank_code VARCHAR(20) UNIQUE NOT NULL,
    bank_name VARCHAR(255) NOT NULL,
    swift_bic VARCHAR(11),
    country_code VARCHAR(3) NOT NULL,
    region VARCHAR(50),
    status VARCHAR(20) DEFAULT 'ACTIVE',      -- ACTIVE, SUSPENDED, INACTIVE
    onboarded_at TIMESTAMPTZ DEFAULT NOW(),
    created_at TIMESTAMPTZ DEFAULT NOW(),
    updated_at TIMESTAMPTZ DEFAULT NOW()
);
```

---

## ğŸ”„ ĞŸĞĞ¢ĞĞš Ğ”ĞĞĞĞ«Ğ¥: ĞÑ‚ Ğ’Ñ…Ğ¾Ğ´Ğ° Ğ´Ğ¾ Ğ¥Ñ€Ğ°Ğ½ĞµĞ½Ğ¸Ñ

### ĞŸÑ€Ğ¸Ğ¼ĞµÑ€: Cross-Border Payment (AED â†’ INR)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ STEP 1: pain.001 ĞŸĞ¾Ğ»ÑƒÑ‡ĞµĞ½                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â†“
Gateway:
â”œâ”€ INSERT INTO payments (...) VALUES (...)                         â† PostgreSQL
â”‚  status = 'Received'
â”‚  created_at = NOW()
â”œâ”€ INSERT INTO payment_events (event_type='RECEIVED', ...)        â† PostgreSQL
â””â”€ PUBLISH to NATS: deltran.compliance.check                       â† NATS (ephemeral)

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ STEP 2: Compliance Check                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â†“
Compliance Engine:
â”œâ”€ SUBSCRIBE NATS: deltran.compliance.check
â”œâ”€ Run AML/KYC/Sanctions check (in-memory, no DB)
â””â”€ PUBLISH to NATS: deltran.obligation.create

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ STEP 3: Obligation Created                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â†“
Obligation Engine:
â”œâ”€ SUBSCRIBE NATS: deltran.obligation.create
â”œâ”€ INSERT INTO obligations (...)                                   â† PostgreSQL
â”‚  status = 'PENDING'
â”‚  payer_id = <Bank UAE ID>
â”‚  payee_id = <Bank IN ID>
â”‚  amount = 100000, currency = 'AED'
â”œâ”€ UPDATE payments SET obligation_id = <obligation.id>            â† PostgreSQL
â””â”€ PUBLISH to NATS: deltran.clearing.submit (cross-border)

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ STEP 4: Multilateral Netting                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â†“
Clearing Engine:
â”œâ”€ SUBSCRIBE NATS: deltran.clearing.submit
â”œâ”€ SELECT * FROM clearing_windows WHERE status='OPEN'             â† PostgreSQL
â”œâ”€ SELECT * FROM obligations WHERE window_id=<current>            â† PostgreSQL
â”œâ”€ Run netting algorithm (in-memory)
â”œâ”€ INSERT INTO net_positions (...)                                â† PostgreSQL
â”‚  gross_debit_a_to_b = 100000
â”‚  gross_credit_b_to_a = 40000
â”‚  net_amount = 60000 (40% saved!)
â”œâ”€ UPDATE obligations SET status='NETTED' WHERE id IN (...)       â† PostgreSQL
â”œâ”€ INSERT INTO settlement_instructions (...)                      â† PostgreSQL
â”‚  amount = 60000 (net position)
â””â”€ PUBLISH to NATS: deltran.liquidity.select

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ STEP 5: Settlement Execution                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â†“
Settlement Engine:
â”œâ”€ SUBSCRIBE NATS: deltran.settlement.execute
â”œâ”€ SELECT * FROM settlement_instructions WHERE id=<id>            â† PostgreSQL
â”œâ”€ Generate pacs.008 (ISO 20022)
â”œâ”€ Send to Bank IL via SWIFT/API
â”œâ”€ UPDATE settlement_instructions                                 â† PostgreSQL
â”‚  SET status='EXECUTING', sent_to_settlement_at=NOW()
â””â”€ UPDATE obligations SET status='EXECUTING'                      â† PostgreSQL

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ STEP 6: Bank Confirmation (camt.054 BOOKED)                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â†“
Gateway:
â”œâ”€ Receive camt.054 from Bank IL
â”œâ”€ Parse message, extract:
â”‚  - amount: 100000 AED
â”‚  - account: IL-EMI-001
â”‚  - status: BOOKED (final, irreversible)
â”‚  - bank_reference: BNK-2025-001234
â”‚  - end_to_end_id: E2E-UAE-IN-20250120-001
â”œâ”€ INSERT INTO emi_transactions (...)                             â† PostgreSQL
â”‚  transaction_type = 'funding'
â”‚  direction = 'CREDIT'
â”‚  amount = 100000
â”‚  bank_reference = 'BNK-2025-001234'
â”‚  status = 'CONFIRMED'
â”œâ”€ UPDATE emi_accounts                                            â† PostgreSQL
â”‚  SET ledger_balance = ledger_balance + 100000
â”‚  WHERE account_id = 'IL-EMI-001'
â”œâ”€ INSERT INTO funding_events (...)                               â† PostgreSQL
â”‚  payment_id = <payment.id>
â”‚  transaction_id = 'BNK-2025-001234'
â”‚  confirmed_at = NOW()
â”œâ”€ UPDATE payments                                                â† PostgreSQL
â”‚  SET status='Funded', funded_at=NOW()
â”‚  WHERE end_to_end_id = 'E2E-UAE-IN-20250120-001'
â””â”€ PUBLISH to NATS: deltran.token.mint                            â† NATS

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ STEP 7: Token Minting (1:1 Backing)                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â†“
Token Engine:
â”œâ”€ SUBSCRIBE NATS: deltran.token.mint
â”œâ”€ Validate:
â”‚  âœ… obligation_status == 'SETTLED' (MUST add this!)
â”‚  âœ… bank_reference exists ('BNK-2025-001234')
â”‚  âœ… not duplicate mint
â”œâ”€ SELECT * FROM emi_accounts WHERE account_id='IL-EMI-001'       â† PostgreSQL
â”‚  Verify: ledger_balance >= 100000 AED
â”œâ”€ INSERT INTO tokens (...)                                       â† PostgreSQL
â”‚  currency = 'xAED'
â”‚  amount = 100000
â”‚  bank_id = <Bank IL ID>
â”‚  reference = 'BNK-2025-001234' (proof of FIAT backing)
â”‚  status = 'ACTIVE'
â”‚  created_at = NOW()
â””â”€ PUBLISH to NATS: deltran.token.minted
```

---

## ğŸ”’ ĞšĞ Ğ˜Ğ¢Ğ˜Ğ§Ğ•Ğ¡ĞšĞ˜Ğ• Ğ“ĞĞ ĞĞĞ¢Ğ˜Ğ˜

### 1ï¸âƒ£ Obligation SETTLED = Token Mint Requirement

**Ğ¢ĞµĞºÑƒÑ‰ĞµĞµ ÑĞ¾ÑÑ‚Ğ¾ÑĞ½Ğ¸Ğµ** (âŒ ĞĞ£Ğ–ĞĞ Ğ˜Ğ¡ĞŸĞ ĞĞ’Ğ˜Ğ¢Ğ¬):
```rust
// services/gateway-rust/src/main.rs:241
// Gateway Ğ½Ğ°Ğ¿Ñ€ÑĞ¼ÑƒÑ Ğ²Ñ‹Ğ·Ñ‹Ğ²Ğ°ĞµÑ‚ Token Engine Ğ¿Ğ¾ÑĞ»Ğµ camt.054
state.router.route_to_token_engine(&payment).await?;
```

**ĞŸÑ€Ğ°Ğ²Ğ¸Ğ»ÑŒĞ½Ğ°Ñ Ğ°Ñ€Ñ…Ğ¸Ñ‚ĞµĞºÑ‚ÑƒÑ€Ğ°** (âœ… Ğ¢Ğ Ğ•Ğ‘Ğ£Ğ•Ğ¢Ğ¡Ğ¯):
```rust
// Settlement Engine Ğ´Ğ¾Ğ»Ğ¶ĞµĞ½:
// 1. ĞŸĞ¾Ğ»ÑƒÑ‡Ğ¸Ñ‚ÑŒ camt.054
// 2. Ğ—Ğ°ĞºÑ€Ñ‹Ñ‚ÑŒ obligation (status='SETTLED')
// 3. Ğ¡Ğ¾Ñ…Ñ€Ğ°Ğ½Ğ¸Ñ‚ÑŒ bank_reference Ğ² obligations Ñ‚Ğ°Ğ±Ğ»Ğ¸Ñ†Ğµ
// 4. Ğ¢ĞĞ›Ğ¬ĞšĞ Ğ¢ĞĞ“Ğ”Ğ Ğ¿ÑƒĞ±Ğ»Ğ¸ĞºĞ¾Ğ²Ğ°Ñ‚ÑŒ deltran.token.mint
```

**ĞĞµĞ¾Ğ±Ñ…Ğ¾Ğ´Ğ¸Ğ¼Ñ‹Ğµ Ğ¸Ğ·Ğ¼ĞµĞ½ĞµĞ½Ğ¸Ñ Ğ² Ğ‘Ğ”**:
```sql
ALTER TABLE obligations ADD COLUMN settled_at TIMESTAMPTZ;
ALTER TABLE obligations ADD COLUMN bank_confirmation_reference VARCHAR(255);
ALTER TABLE obligations ADD COLUMN camt054_entry_reference VARCHAR(255);
```

### 2ï¸âƒ£ 1:1 Backing Ñ‡ĞµÑ€ĞµĞ· Reconciliation

**Ğ•Ğ¶ĞµĞ´Ğ½ĞµĞ²Ğ½Ğ°Ñ ÑĞ²ĞµÑ€ĞºĞ°**:
```sql
-- EOD Reconciliation Query
SELECT
    ea.id AS account_id,
    ea.currency,
    ea.ledger_balance AS our_balance,
    ea.bank_reported_balance AS bank_balance,
    ea.ledger_balance - ea.bank_reported_balance AS difference,
    (SELECT SUM(amount) FROM tokens WHERE currency = 'x' || ea.currency AND status='ACTIVE') AS total_tokens_minted
FROM emi_accounts ea
WHERE ea.account_type = 'client_funds'
  AND ABS(ea.ledger_balance - ea.bank_reported_balance) > 0.01;
```

**Ğ•ÑĞ»Ğ¸ Ñ€Ğ°Ğ·Ğ½Ğ¸Ñ†Ğ° Ğ½Ğ°Ğ¹Ğ´ĞµĞ½Ğ°**:
```sql
INSERT INTO reconciliation_discrepancies (
    account_id,
    discrepancy_type,
    expected_value,
    actual_value,
    difference,
    status
) VALUES (
    <account_id>,
    'BALANCE_MISMATCH',
    <our_balance>,
    <bank_balance>,
    <difference>,
    'OPEN'
);
```

### 3ï¸âƒ£ Audit Trail

**ĞšĞ°Ğ¶Ğ´Ğ°Ñ Ñ‚Ñ€Ğ°Ğ½Ğ·Ğ°ĞºÑ†Ğ¸Ñ Ğ¿Ñ€Ğ¾ÑĞ»ĞµĞ¶Ğ¸Ğ²Ğ°ĞµÑ‚ÑÑ**:
```
payment.deltran_tx_id
  â†“
obligation.transaction_id = payment.deltran_tx_id
  â†“
settlement_instruction.net_position_id â†’ net_positions.id
  â†“
emi_transaction.related_transaction_id = payment.deltran_tx_id
emi_transaction.bank_reference = 'BNK-2025-001234'
  â†“
token.reference = 'BNK-2025-001234'
```

**Query Ğ´Ğ»Ñ Ğ¿Ğ¾Ğ»Ğ½Ğ¾Ğ¹ Ğ¸ÑÑ‚Ğ¾Ñ€Ğ¸Ğ¸**:
```sql
SELECT
    p.deltran_tx_id,
    p.end_to_end_id,
    p.status AS payment_status,
    o.status AS obligation_status,
    o.settled_at,
    et.bank_reference,
    et.confirmed_at AS fiat_confirmed,
    t.id AS token_id,
    t.amount AS token_amount,
    t.created_at AS token_minted
FROM payments p
LEFT JOIN obligations o ON o.transaction_id = p.deltran_tx_id
LEFT JOIN emi_transactions et ON et.related_transaction_id = p.deltran_tx_id
LEFT JOIN tokens t ON t.reference = et.bank_reference
WHERE p.deltran_tx_id = '<UUID>';
```

---

## ğŸ“ˆ ĞœĞ•Ğ¢Ğ Ğ˜ĞšĞ˜ Ğ˜ ĞœĞĞĞ˜Ğ¢ĞĞ Ğ˜ĞĞ“

### Database Metrics (Ğ¡Ğ¾Ğ±Ğ¸Ñ€Ğ°ÑÑ‚ÑÑ Ğ°Ğ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ¸):

```sql
-- Active connections
SELECT count(*) FROM pg_stat_activity;

-- Top 10 slowest queries
SELECT query, mean_exec_time, calls
FROM pg_stat_statements
ORDER BY mean_exec_time DESC
LIMIT 10;

-- Table sizes
SELECT
    schemaname,
    tablename,
    pg_size_pretty(pg_total_relation_size(schemaname||'.'||tablename)) AS size
FROM pg_tables
WHERE schemaname = 'public'
ORDER BY pg_total_relation_size(schemaname||'.'||tablename) DESC;
```

### Business Metrics:

```sql
-- Today's payment volume
SELECT
    currency,
    COUNT(*) AS count,
    SUM(instructed_amount) AS total_volume,
    AVG(instructed_amount) AS avg_amount
FROM payments
WHERE created_at >= CURRENT_DATE
GROUP BY currency;

-- Netting efficiency (last 7 days)
SELECT
    window_name,
    total_gross_value,
    total_net_value,
    netting_efficiency,
    saved_amount
FROM clearing_windows
WHERE created_at >= CURRENT_DATE - INTERVAL '7 days'
ORDER BY created_at DESC;

-- Token supply by currency
SELECT
    currency,
    COUNT(*) AS token_count,
    SUM(amount) AS total_supply
FROM tokens
WHERE status = 'ACTIVE'
GROUP BY currency;

-- EMI account balances
SELECT
    country_code,
    currency,
    account_type,
    SUM(ledger_balance) AS total_balance,
    SUM(reserved_balance) AS total_reserved,
    SUM(available_balance) AS total_available
FROM emi_accounts
GROUP BY country_code, currency, account_type;
```

---

## ğŸ” BACKUP Ğ˜ DISASTER RECOVERY

### Ğ ĞµĞºĞ¾Ğ¼ĞµĞ½Ğ´ÑƒĞµĞ¼Ğ°Ñ ÑÑ‚Ñ€Ğ°Ñ‚ĞµĞ³Ğ¸Ñ:

1. **PostgreSQL WAL Archiving**:
   ```
   archive_mode = on
   archive_command = 'cp %p /backup/wal/%f'
   ```

2. **Daily Full Backup**:
   ```bash
   pg_dump -Fc deltran_db > /backup/deltran_$(date +%Y%m%d).dump
   ```

3. **Hourly Incremental Backup**:
   ```bash
   pg_basebackup -D /backup/incremental/$(date +%Y%m%d_%H)
   ```

4. **Critical Tables - Realtime Replication**:
   - `payments`
   - `obligations`
   - `emi_transactions`
   - `tokens`

---

## âœ… Ğ˜Ğ¢ĞĞ“ĞĞ’ĞĞ¯ Ğ¡Ğ¥Ğ•ĞœĞ Ğ¥Ğ ĞĞĞ•ĞĞ˜Ğ¯

| Ğ¡ĞµÑ€Ğ²Ğ¸Ñ | Ğ¢Ğ°Ğ±Ğ»Ğ¸Ñ†Ñ‹ | ĞĞ°Ğ·Ğ½Ğ°Ñ‡ĞµĞ½Ğ¸Ğµ | ĞšÑ€Ğ¸Ñ‚Ğ¸Ñ‡Ğ½Ğ¾ÑÑ‚ÑŒ |
|--------|---------|------------|-------------|
| **Gateway** | `payments`, `payment_events` | Ğ’Ñ…Ğ¾Ğ´ÑÑ‰Ğ¸Ğµ ISO 20022 ÑĞ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ñ | ğŸ”´ CRITICAL |
| **Obligation** | `obligations` | ĞĞ±ÑĞ·Ğ°Ñ‚ĞµĞ»ÑŒÑÑ‚Ğ²Ğ° Ğ¿Ğ¾ Ğ¿Ğ»Ğ°Ñ‚ĞµĞ¶Ğ°Ğ¼ | ğŸ”´ CRITICAL |
| **Clearing** | `clearing_windows`, `net_positions`, `settlement_instructions` | Multilateral netting | ğŸŸ¡ HIGH |
| **Token** | `tokens` | Tokenized assets (1:1 backed) | ğŸ”´ CRITICAL |
| **EMI Accounts** | `emi_accounts`, `emi_transactions`, `emi_account_snapshots` | Real FIAT balances | ğŸ”´ CRITICAL |
| **Account Monitor** | `funding_events`, `unmatched_transactions` | FIAT confirmation tracking | ğŸ”´ CRITICAL |
| **Risk** | `fx_rate_ticks`, `fx_rate_daily`, `fx_rate_volatility`, `fx_currency_pairs` | FX risk management | ğŸŸ¡ HIGH |
| **Directory** | `banks` | Bank participants registry | ğŸŸ¢ MEDIUM |

---

## ğŸ¯ Ğ Ğ•ĞšĞĞœĞ•ĞĞ”ĞĞ¦Ğ˜Ğ˜

### ĞĞµĞ¼ĞµĞ´Ğ»ĞµĞ½Ğ½Ğ¾ (P0):

1. âœ… **Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ¸Ñ‚ÑŒ obligation closing Ğ² Settlement Engine**
   - ĞŸĞ¾Ğ»Ñ: `settled_at`, `bank_confirmation_reference`
   - Ğ›Ğ¾Ğ³Ğ¸ĞºĞ°: Settlement Engine Ğ·Ğ°ĞºÑ€Ñ‹Ğ²Ğ°ĞµÑ‚ obligation Ğ¿Ñ€Ğ¸ camt.054

2. âœ… **Token Engine validation**
   - ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑÑ‚ÑŒ `obligation_status == 'SETTLED'`
   - ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑÑ‚ÑŒ `bank_reference` exists

3. âœ… **Reconciliation automation**
   - Ğ•Ğ¶ĞµĞ´Ğ½ĞµĞ²Ğ½Ğ°Ñ cĞ²ĞµÑ€ĞºĞ°: EMI accounts vs Tokens
   - Alerts Ğ¿Ñ€Ğ¸ Ñ€Ğ°ÑÑ…Ğ¾Ğ¶Ğ´ĞµĞ½Ğ¸ÑÑ… > 0.01%

### Ğ’ Ğ±Ğ»Ğ¸Ğ¶Ğ°Ğ¹ÑˆĞµĞµ Ğ²Ñ€ĞµĞ¼Ñ (P1):

4. âœ… **Database monitoring**
   - Prometheus exporter Ğ´Ğ»Ñ PostgreSQL
   - Grafana dashboards Ğ´Ğ»Ñ business metrics

5. âœ… **Backup automation**
   - ĞĞ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ¸Ğµ WAL backups
   - Point-in-time recovery testing

6. âœ… **Audit logging**
   - Ğ’ÑĞµ INSERT/UPDATE/DELETE Ğ² critical Ñ‚Ğ°Ğ±Ğ»Ğ¸Ñ†Ğ°Ñ…
   - Trigger-based audit trail

---

**Ğ¡Ñ‚Ğ°Ñ‚ÑƒÑ**: âœ… ĞŸĞ¾Ğ»Ğ½Ğ°Ñ ĞºĞ°Ñ€Ñ‚Ğ° Ñ…Ñ€Ğ°Ğ½ĞµĞ½Ğ¸Ñ Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ… DelTran
**Database**: PostgreSQL (ĞµĞ´Ğ¸Ğ½Ğ°Ñ Ğ‘Ğ”, Ñ€Ğ°Ğ·Ğ½Ñ‹Ğµ Ñ‚Ğ°Ğ±Ğ»Ğ¸Ñ†Ñ‹ Ğ¿Ğ¾ ÑĞµÑ€Ğ²Ğ¸ÑĞ°Ğ¼)
**Messaging**: NATS (ephemeral, Ğ½Ğµ Ñ…Ñ€Ğ°Ğ½Ğ¸Ñ‚ Ğ´Ğ°Ğ½Ğ½Ñ‹Ğµ)
**Backup**: Ğ¢Ñ€ĞµĞ±ÑƒĞµÑ‚ÑÑ Ğ½Ğ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ° (ÑĞ¼. Ñ€ĞµĞºĞ¾Ğ¼ĞµĞ½Ğ´Ğ°Ñ†Ğ¸Ğ¸)
