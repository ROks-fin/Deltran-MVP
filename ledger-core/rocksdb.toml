# RocksDB Configuration for DelTran Ledger
# Optimized for write-heavy workload with strong consistency

[rocksdb]
# Write buffer size (MB) - larger buffers reduce write amplification
write_buffer_size_mb = 64

# Number of write buffers - allows parallel writes
max_write_buffer_number = 4

# Target file size (MB) for SST files
target_file_size_mb = 64

# Max background jobs (compaction + flush)
# Recommendation: num_cpu_cores
max_background_jobs = 8

# Level 0 compaction trigger
# Higher value = more write throughput, but slower reads
level0_file_num_compaction_trigger = 4

# Enable detailed statistics
enable_statistics = true

# Compression settings
[rocksdb.compression]
# Use Zstd for events and blocks (best compression ratio)
events = "zstd"
blocks = "zstd"
# Use LZ4 for state and indices (faster decompression)
state = "lz4"
indices = "lz4"
merkle = "lz4"
snapshots = "zstd"

# Cache configuration
[rocksdb.cache]
# Block cache size (MB) - improves read performance
block_cache_size_mb = 256

# Row cache size (MB) - caches entire rows
row_cache_size_mb = 128

# Bloom filter configuration
[rocksdb.bloom]
# Bits per key for bloom filters (higher = fewer false positives)
bits_per_key = 10
# Block-based bloom filter
block_based = true

# Compaction configuration
[rocksdb.compaction]
# Universal compaction style for write-heavy workload
style = "universal"
# Max bytes for level base
max_bytes_for_level_base_mb = 256
# Size ratio for universal compaction
size_ratio = 1

# WAL (Write-Ahead Log) configuration
[rocksdb.wal]
# WAL size limit (MB) - triggers archival
size_limit_mb = 1024
# WAL TTL (seconds) - older WALs are archived
ttl_seconds = 3600
# Sync WAL on every write (strong durability)
sync_wal = true

# Backup configuration
[backup]
# Backup directory
backup_dir = "./data/backups"
# Keep last N backups
max_backups = 10
# Backup interval (seconds)
interval_seconds = 3600

# Snapshot configuration
[snapshot]
# Snapshot directory
snapshot_dir = "./data/snapshots"
# Snapshot interval (seconds)
interval_seconds = 7200
# Keep last N snapshots
max_snapshots = 5
