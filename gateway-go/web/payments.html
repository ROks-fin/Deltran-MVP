<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Payments - DelTran Gateway</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: linear-gradient(135deg, #0A0E27 0%, #1a1a2e 50%, #16213e 100%);
            color: #E8E8E8;
            min-height: 100vh;
            overflow-x: hidden;
        }

        .container {
            max-width: 1600px;
            margin: 0 auto;
            padding: 2rem;
        }

        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
            padding: 1.5rem;
            background: linear-gradient(135deg, rgba(15, 23, 42, 0.5), rgba(30, 41, 59, 0.3));
            backdrop-filter: blur(20px);
            border-radius: 16px;
            border: 1px solid rgba(244, 208, 63, 0.1);
        }

        .header h1 {
            font-size: 2.5rem;
            background: linear-gradient(135deg, #F4D03F 0%, #FFA500 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .back-btn {
            padding: 0.75rem 1.5rem;
            background: linear-gradient(135deg, rgba(244, 208, 63, 0.1), rgba(255, 165, 0, 0.1));
            border: 1px solid rgba(244, 208, 63, 0.3);
            border-radius: 8px;
            color: #F4D03F;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
            font-size: 1rem;
        }

        .back-btn:hover {
            background: linear-gradient(135deg, rgba(244, 208, 63, 0.2), rgba(255, 165, 0, 0.2));
            border-color: rgba(244, 208, 63, 0.5);
            box-shadow: 0 0 20px rgba(244, 208, 63, 0.3);
        }

        .actions-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .action-card {
            background: linear-gradient(135deg, rgba(15, 23, 42, 0.5), rgba(30, 41, 59, 0.3));
            backdrop-filter: blur(20px);
            border: 1px solid rgba(244, 208, 63, 0.1);
            border-radius: 16px;
            padding: 2rem;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .action-card:hover {
            border-color: rgba(244, 208, 63, 0.3);
            box-shadow: 0 8px 32px rgba(244, 208, 63, 0.15);
            transform: translateY(-4px);
        }

        .action-card h3 {
            color: #F4D03F;
            margin-bottom: 0.5rem;
            font-size: 1.2rem;
        }

        .action-card p {
            color: #A0AEC0;
            font-size: 0.9rem;
        }

        .action-icon {
            font-size: 2.5rem;
            margin-bottom: 1rem;
        }

        .data-section {
            background: linear-gradient(135deg, rgba(15, 23, 42, 0.5), rgba(30, 41, 59, 0.3));
            backdrop-filter: blur(20px);
            border: 1px solid rgba(244, 208, 63, 0.1);
            border-radius: 16px;
            padding: 2rem;
            margin-bottom: 2rem;
        }

        .data-section h2 {
            color: #F4D03F;
            margin-bottom: 1.5rem;
            font-size: 1.5rem;
        }

        .payments-table {
            width: 100%;
            border-collapse: collapse;
        }

        .payments-table thead {
            background: rgba(244, 208, 63, 0.05);
        }

        .payments-table th {
            padding: 1rem;
            text-align: left;
            color: #F4D03F;
            font-weight: 600;
            border-bottom: 2px solid rgba(244, 208, 63, 0.2);
        }

        .payments-table td {
            padding: 1rem;
            border-bottom: 1px solid rgba(244, 208, 63, 0.05);
        }

        .payments-table tr:hover {
            background: rgba(244, 208, 63, 0.03);
        }

        .status-badge {
            padding: 0.25rem 0.75rem;
            border-radius: 12px;
            font-size: 0.85rem;
            font-weight: 600;
            display: inline-block;
        }

        .status-settled {
            background: rgba(16, 185, 129, 0.2);
            color: #10B981;
            border: 1px solid rgba(16, 185, 129, 0.3);
        }

        .status-settling {
            background: rgba(59, 130, 246, 0.2);
            color: #3B82F6;
            border: 1px solid rgba(59, 130, 246, 0.3);
        }

        .status-queued {
            background: rgba(245, 158, 11, 0.2);
            color: #F59E0B;
            border: 1px solid rgba(245, 158, 11, 0.3);
        }

        .status-initiated {
            background: rgba(156, 163, 175, 0.2);
            color: #9CA3AF;
            border: 1px solid rgba(156, 163, 175, 0.3);
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(10px);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }

        .modal-content {
            background: linear-gradient(135deg, rgba(15, 23, 42, 0.95), rgba(30, 41, 59, 0.95));
            backdrop-filter: blur(20px);
            border: 2px solid rgba(244, 208, 63, 0.3);
            border-radius: 20px;
            padding: 2.5rem;
            max-width: 600px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: 0 20px 60px rgba(244, 208, 63, 0.3);
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
        }

        .modal-header h2 {
            color: #F4D03F;
            font-size: 1.8rem;
        }

        .close-btn {
            background: none;
            border: none;
            color: #F4D03F;
            font-size: 2rem;
            cursor: pointer;
            padding: 0;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 8px;
            transition: all 0.3s ease;
        }

        .close-btn:hover {
            background: rgba(244, 208, 63, 0.1);
        }

        .form-group {
            margin-bottom: 1.5rem;
        }

        .form-group label {
            display: block;
            color: #F4D03F;
            margin-bottom: 0.5rem;
            font-weight: 500;
        }

        .form-group input,
        .form-group select {
            width: 100%;
            padding: 0.75rem;
            background: rgba(15, 23, 42, 0.5);
            border: 1px solid rgba(244, 208, 63, 0.2);
            border-radius: 8px;
            color: #E8E8E8;
            font-size: 1rem;
        }

        .form-group input:focus,
        .form-group select:focus {
            outline: none;
            border-color: rgba(244, 208, 63, 0.5);
            box-shadow: 0 0 10px rgba(244, 208, 63, 0.2);
        }

        .submit-btn {
            width: 100%;
            padding: 1rem;
            background: linear-gradient(135deg, #F4D03F, #FFA500);
            border: none;
            border-radius: 8px;
            color: #0A0E27;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .submit-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 30px rgba(244, 208, 63, 0.4);
        }

        .result-box {
            margin-top: 1.5rem;
            padding: 1.5rem;
            background: rgba(16, 185, 129, 0.1);
            border: 1px solid rgba(16, 185, 129, 0.3);
            border-radius: 12px;
            display: none;
        }

        .result-box h3 {
            color: #10B981;
            margin-bottom: 1rem;
        }

        .result-item {
            display: flex;
            justify-content: space-between;
            padding: 0.5rem 0;
            border-bottom: 1px solid rgba(16, 185, 129, 0.1);
        }

        .result-item:last-child {
            border-bottom: none;
        }

        .result-label {
            color: #A0AEC0;
        }

        .result-value {
            color: #E8E8E8;
            font-weight: 600;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .animate-in {
            animation: fadeIn 0.5s ease-out;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header animate-in">
            <h1>üí≥ Payments</h1>
            <a href="corridors-premium.html" class="back-btn">‚Üê Back to Dashboard</a>
        </div>

        <div class="actions-grid">
            <div class="action-card animate-in" onclick="openInitiateModal()">
                <div class="action-icon">üöÄ</div>
                <h3>Initiate Payment</h3>
                <p>Create a new cross-border payment transaction</p>
            </div>

            <div class="action-card animate-in" onclick="openStatusModal()">
                <div class="action-icon">üîç</div>
                <h3>Check Status</h3>
                <p>Track payment progress with detailed timeline</p>
            </div>

            <div class="action-card animate-in" onclick="openQuoteModal()">
                <div class="action-icon">üí±</div>
                <h3>Get Quote</h3>
                <p>Calculate FX rates and routing options</p>
            </div>

            <div class="action-card animate-in" onclick="openFeesModal()">
                <div class="action-icon">üí∞</div>
                <h3>Calculate Fees</h3>
                <p>Get detailed fee breakdown with netting discounts</p>
            </div>

            <div class="action-card animate-in" onclick="openCancelModal()">
                <div class="action-icon">‚ùå</div>
                <h3>Cancel Payment</h3>
                <p>Cancel pending or queued payments</p>
            </div>

            <div class="action-card animate-in" onclick="loadPaymentsList()">
                <div class="action-icon">üìã</div>
                <h3>View All Payments</h3>
                <p>Browse recent payment transactions</p>
            </div>
        </div>

        <div class="data-section animate-in">
            <h2>Recent Payments</h2>
            <table class="payments-table" id="paymentsTable">
                <thead>
                    <tr>
                        <th>Payment ID</th>
                        <th>Amount</th>
                        <th>Currency</th>
                        <th>From Bank</th>
                        <th>To Bank</th>
                        <th>Status</th>
                        <th>Created</th>
                        <th>ETA</th>
                    </tr>
                </thead>
                <tbody id="paymentsTableBody">
                    <tr>
                        <td colspan="8" style="text-align: center; padding: 2rem; color: #A0AEC0;">
                            Loading payments...
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>

    <!-- Initiate Payment Modal -->
    <div class="modal" id="initiateModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>üöÄ Initiate Payment</h2>
                <button class="close-btn" onclick="closeModal('initiateModal')">√ó</button>
            </div>
            <form id="initiateForm" onsubmit="initiatePayment(event)">
                <div class="form-group">
                    <label>Debtor Bank (BIC)</label>
                    <input type="text" name="debtor_bank" placeholder="CHASUS33XXX" required>
                </div>
                <div class="form-group">
                    <label>Creditor Bank (BIC)</label>
                    <input type="text" name="creditor_bank" placeholder="DEUTDEFFXXX" required>
                </div>
                <div class="form-group">
                    <label>Debtor Account</label>
                    <input type="text" name="debtor_account" placeholder="US12345678901234567890" required>
                </div>
                <div class="form-group">
                    <label>Creditor Account</label>
                    <input type="text" name="creditor_account" placeholder="DE89370400440532013000" required>
                </div>
                <div class="form-group">
                    <label>Debtor Name</label>
                    <input type="text" name="debtor_name" placeholder="John Doe" required>
                </div>
                <div class="form-group">
                    <label>Creditor Name</label>
                    <input type="text" name="creditor_name" placeholder="Jane Smith" required>
                </div>
                <div class="form-group">
                    <label>Amount</label>
                    <input type="number" name="amount" step="0.01" placeholder="50000.00" required>
                </div>
                <div class="form-group">
                    <label>Currency</label>
                    <select name="currency" required>
                        <option value="USD">USD</option>
                        <option value="EUR">EUR</option>
                        <option value="GBP">GBP</option>
                        <option value="INR">INR</option>
                        <option value="AED">AED</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Reference</label>
                    <input type="text" name="reference" placeholder="Invoice #12345">
                </div>
                <button type="submit" class="submit-btn">Initiate Payment</button>
            </form>
            <div class="result-box" id="initiateResult"></div>
        </div>
    </div>

    <!-- Status Check Modal -->
    <div class="modal" id="statusModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>üîç Payment Status</h2>
                <button class="close-btn" onclick="closeModal('statusModal')">√ó</button>
            </div>
            <form id="statusForm" onsubmit="checkStatus(event)">
                <div class="form-group">
                    <label>Payment ID</label>
                    <input type="text" name="payment_id" placeholder="Enter payment ID" required>
                </div>
                <button type="submit" class="submit-btn">Check Status</button>
            </form>
            <div class="result-box" id="statusResult"></div>
        </div>
    </div>

    <!-- Quote Modal -->
    <div class="modal" id="quoteModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>üí± Get Quote</h2>
                <button class="close-btn" onclick="closeModal('quoteModal')">√ó</button>
            </div>
            <form id="quoteForm" onsubmit="getQuote(event)">
                <div class="form-group">
                    <label>From Currency</label>
                    <select name="from_currency" required>
                        <option value="USD">USD</option>
                        <option value="EUR">EUR</option>
                        <option value="GBP">GBP</option>
                        <option value="INR">INR</option>
                        <option value="AED">AED</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>To Currency</label>
                    <select name="to_currency" required>
                        <option value="EUR">EUR</option>
                        <option value="USD">USD</option>
                        <option value="GBP">GBP</option>
                        <option value="INR">INR</option>
                        <option value="AED">AED</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Amount</label>
                    <input type="number" name="amount" step="0.01" placeholder="10000.00" required>
                </div>
                <div class="form-group">
                    <label>Corridor</label>
                    <input type="text" name="corridor" placeholder="US-EU" required>
                </div>
                <button type="submit" class="submit-btn">Get Quote</button>
            </form>
            <div class="result-box" id="quoteResult"></div>
        </div>
    </div>

    <!-- Fees Modal -->
    <div class="modal" id="feesModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>üí∞ Calculate Fees</h2>
                <button class="close-btn" onclick="closeModal('feesModal')">√ó</button>
            </div>
            <form id="feesForm" onsubmit="calculateFees(event)">
                <div class="form-group">
                    <label>Amount</label>
                    <input type="number" name="amount" step="0.01" placeholder="50000.00" required>
                </div>
                <div class="form-group">
                    <label>Currency</label>
                    <select name="currency" required>
                        <option value="USD">USD</option>
                        <option value="EUR">EUR</option>
                        <option value="GBP">GBP</option>
                        <option value="INR">INR</option>
                        <option value="AED">AED</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Corridor</label>
                    <input type="text" name="corridor" placeholder="UAE-IN" required>
                </div>
                <div class="form-group">
                    <label>Priority</label>
                    <select name="priority" required>
                        <option value="NORMAL">Normal</option>
                        <option value="EXPRESS">Express</option>
                        <option value="INSTANT">Instant</option>
                    </select>
                </div>
                <button type="submit" class="submit-btn">Calculate Fees</button>
            </form>
            <div class="result-box" id="feesResult"></div>
        </div>
    </div>

    <!-- Cancel Modal -->
    <div class="modal" id="cancelModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>‚ùå Cancel Payment</h2>
                <button class="close-btn" onclick="closeModal('cancelModal')">√ó</button>
            </div>
            <form id="cancelForm" onsubmit="cancelPayment(event)">
                <div class="form-group">
                    <label>Payment ID</label>
                    <input type="text" name="payment_id" placeholder="Enter payment ID" required>
                </div>
                <div class="form-group">
                    <label>Reason</label>
                    <input type="text" name="reason" placeholder="Reason for cancellation" required>
                </div>
                <button type="submit" class="submit-btn">Cancel Payment</button>
            </form>
            <div class="result-box" id="cancelResult"></div>
        </div>
    </div>

    <script>
        const API_BASE = 'http://localhost:8080/api/v1';

        function openModal(modalId) {
            document.getElementById(modalId).style.display = 'flex';
        }

        function closeModal(modalId) {
            document.getElementById(modalId).style.display = 'none';
            // Reset form and result
            const modal = document.getElementById(modalId);
            const form = modal.querySelector('form');
            const result = modal.querySelector('.result-box');
            if (form) form.reset();
            if (result) result.style.display = 'none';
        }

        function openInitiateModal() { openModal('initiateModal'); }
        function openStatusModal() { openModal('statusModal'); }
        function openQuoteModal() { openModal('quoteModal'); }
        function openFeesModal() { openModal('feesModal'); }
        function openCancelModal() { openModal('cancelModal'); }

        async function initiatePayment(event) {
            event.preventDefault();
            const form = event.target;
            const formData = new FormData(form);
            const data = {
                debtor_bank: formData.get('debtor_bank'),
                creditor_bank: formData.get('creditor_bank'),
                debtor_account: formData.get('debtor_account'),
                creditor_account: formData.get('creditor_account'),
                debtor_name: formData.get('debtor_name'),
                creditor_name: formData.get('creditor_name'),
                amount: parseFloat(formData.get('amount')),
                currency: formData.get('currency'),
                reference: formData.get('reference')
            };

            try {
                const response = await fetch(`${API_BASE}/payments/initiate`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(data)
                });
                const result = await response.json();

                const resultBox = document.getElementById('initiateResult');
                resultBox.innerHTML = `
                    <h3>‚úÖ Payment Initiated Successfully</h3>
                    <div class="result-item">
                        <span class="result-label">Payment ID:</span>
                        <span class="result-value">${result.payment_id}</span>
                    </div>
                    <div class="result-item">
                        <span class="result-label">UETR:</span>
                        <span class="result-value">${result.uetr}</span>
                    </div>
                    <div class="result-item">
                        <span class="result-label">Status:</span>
                        <span class="result-value">${result.status}</span>
                    </div>
                    <div class="result-item">
                        <span class="result-label">Created At:</span>
                        <span class="result-value">${new Date(result.created_at).toLocaleString()}</span>
                    </div>
                    <div class="result-item">
                        <span class="result-label">Message:</span>
                        <span class="result-value">${result.message}</span>
                    </div>
                `;
                resultBox.style.display = 'block';
                loadPaymentsList();
            } catch (error) {
                alert('Error initiating payment: ' + error.message);
            }
        }

        async function checkStatus(event) {
            event.preventDefault();
            const form = event.target;
            const formData = new FormData(form);
            const paymentId = formData.get('payment_id');

            try {
                const response = await fetch(`${API_BASE}/payments/status?id=${paymentId}`);
                const result = await response.json();

                const resultBox = document.getElementById('statusResult');
                let timelineHTML = '<h4 style="color: #F4D03F; margin-top: 1rem;">Timeline:</h4>';
                result.timeline.forEach(step => {
                    let statusColor = step.status === 'COMPLETED' ? '#10B981' :
                                     step.status === 'IN_PROGRESS' ? '#3B82F6' : '#9CA3AF';
                    timelineHTML += `
                        <div style="padding: 0.5rem; margin: 0.5rem 0; background: rgba(${step.status === 'COMPLETED' ? '16, 185, 129' : '156, 163, 175'}, 0.1); border-radius: 8px;">
                            <span style="color: ${statusColor}; font-weight: 600;">${step.step}</span>
                            <span style="float: right; color: #A0AEC0;">${step.status}</span>
                        </div>
                    `;
                });

                resultBox.innerHTML = `
                    <h3>üìä Payment Status</h3>
                    <div class="result-item">
                        <span class="result-label">Payment ID:</span>
                        <span class="result-value">${result.payment_id}</span>
                    </div>
                    <div class="result-item">
                        <span class="result-label">Status:</span>
                        <span class="result-value">${result.status}</span>
                    </div>
                    <div class="result-item">
                        <span class="result-label">Amount:</span>
                        <span class="result-value">${result.amount} ${result.currency}</span>
                    </div>
                    <div class="result-item">
                        <span class="result-label">From:</span>
                        <span class="result-value">${result.debtor_bank}</span>
                    </div>
                    <div class="result-item">
                        <span class="result-label">To:</span>
                        <span class="result-value">${result.creditor_bank}</span>
                    </div>
                    <div class="result-item">
                        <span class="result-label">Current Step:</span>
                        <span class="result-value">${result.current_step}</span>
                    </div>
                    <div class="result-item">
                        <span class="result-label">ETA:</span>
                        <span class="result-value">${result.estimated_completion_time}</span>
                    </div>
                    ${timelineHTML}
                `;
                resultBox.style.display = 'block';
            } catch (error) {
                alert('Error checking status: ' + error.message);
            }
        }

        async function getQuote(event) {
            event.preventDefault();
            const form = event.target;
            const formData = new FormData(form);
            const data = {
                from_currency: formData.get('from_currency'),
                to_currency: formData.get('to_currency'),
                amount: parseFloat(formData.get('amount')),
                corridor: formData.get('corridor')
            };

            try {
                const response = await fetch(`${API_BASE}/payments/quote`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(data)
                });
                const result = await response.json();

                const resultBox = document.getElementById('quoteResult');
                resultBox.innerHTML = `
                    <h3>üí± Quote Details</h3>
                    <div class="result-item">
                        <span class="result-label">Quote ID:</span>
                        <span class="result-value">${result.quote_id}</span>
                    </div>
                    <div class="result-item">
                        <span class="result-label">From Amount:</span>
                        <span class="result-value">${result.from_amount} ${result.from_currency}</span>
                    </div>
                    <div class="result-item">
                        <span class="result-label">To Amount:</span>
                        <span class="result-value">${result.to_amount} ${result.to_currency}</span>
                    </div>
                    <div class="result-item">
                        <span class="result-label">Exchange Rate:</span>
                        <span class="result-value">${result.exchange_rate}</span>
                    </div>
                    <div class="result-item">
                        <span class="result-label">Fee:</span>
                        <span class="result-value">${result.fee} ${result.from_currency}</span>
                    </div>
                    <div class="result-item">
                        <span class="result-label">Total Cost:</span>
                        <span class="result-value">${result.total_cost} ${result.from_currency}</span>
                    </div>
                    <div class="result-item">
                        <span class="result-label">Route:</span>
                        <span class="result-value">${result.route.join(' ‚Üí ')}</span>
                    </div>
                    <div class="result-item">
                        <span class="result-label">Expires At:</span>
                        <span class="result-value">${new Date(result.expires_at).toLocaleString()}</span>
                    </div>
                `;
                resultBox.style.display = 'block';
            } catch (error) {
                alert('Error getting quote: ' + error.message);
            }
        }

        async function calculateFees(event) {
            event.preventDefault();
            const form = event.target;
            const formData = new FormData(form);
            const data = {
                amount: parseFloat(formData.get('amount')),
                currency: formData.get('currency'),
                corridor: formData.get('corridor'),
                priority: formData.get('priority')
            };

            try {
                const response = await fetch(`${API_BASE}/payments/fees/calc`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(data)
                });
                const result = await response.json();

                let breakdownHTML = '<h4 style="color: #F4D03F; margin-top: 1rem;">Fee Breakdown:</h4>';
                result.breakdown.forEach(item => {
                    breakdownHTML += `
                        <div class="result-item">
                            <span class="result-label">${item.description}:</span>
                            <span class="result-value">${item.amount.toFixed(2)} ${data.currency}</span>
                        </div>
                    `;
                });

                const resultBox = document.getElementById('feesResult');
                resultBox.innerHTML = `
                    <h3>üí∞ Fee Calculation</h3>
                    <div class="result-item">
                        <span class="result-label">Base Fee:</span>
                        <span class="result-value">${result.base_fee.toFixed(2)} ${data.currency}</span>
                    </div>
                    <div class="result-item">
                        <span class="result-label">Corridor Fee:</span>
                        <span class="result-value">${result.corridor_fee.toFixed(2)} ${data.currency}</span>
                    </div>
                    <div class="result-item">
                        <span class="result-label">Priority Fee:</span>
                        <span class="result-value">${result.priority_fee.toFixed(2)} ${data.currency}</span>
                    </div>
                    <div class="result-item">
                        <span class="result-label">Netting Discount:</span>
                        <span class="result-value" style="color: #10B981;">-${result.netting_discount.toFixed(2)} ${data.currency}</span>
                    </div>
                    <div class="result-item" style="border-top: 2px solid rgba(244, 208, 63, 0.3); padding-top: 1rem; margin-top: 1rem;">
                        <span class="result-label" style="font-size: 1.1rem; font-weight: 700;">Total Fee:</span>
                        <span class="result-value" style="font-size: 1.1rem; font-weight: 700; color: #F4D03F;">${result.total_fee.toFixed(2)} ${data.currency}</span>
                    </div>
                    ${breakdownHTML}
                `;
                resultBox.style.display = 'block';
            } catch (error) {
                alert('Error calculating fees: ' + error.message);
            }
        }

        async function cancelPayment(event) {
            event.preventDefault();
            const form = event.target;
            const formData = new FormData(form);
            const data = {
                payment_id: formData.get('payment_id'),
                reason: formData.get('reason')
            };

            try {
                const response = await fetch(`${API_BASE}/payments/cancel`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(data)
                });
                const result = await response.json();

                const resultBox = document.getElementById('cancelResult');
                resultBox.innerHTML = `
                    <h3>‚ùå Payment Cancelled</h3>
                    <div class="result-item">
                        <span class="result-label">Payment ID:</span>
                        <span class="result-value">${result.payment_id}</span>
                    </div>
                    <div class="result-item">
                        <span class="result-label">Status:</span>
                        <span class="result-value">${result.status}</span>
                    </div>
                    <div class="result-item">
                        <span class="result-label">Message:</span>
                        <span class="result-value">${result.message}</span>
                    </div>
                    <div class="result-item">
                        <span class="result-label">Timestamp:</span>
                        <span class="result-value">${new Date(result.timestamp).toLocaleString()}</span>
                    </div>
                `;
                resultBox.style.display = 'block';
                loadPaymentsList();
            } catch (error) {
                alert('Error cancelling payment: ' + error.message);
            }
        }

        async function loadPaymentsList() {
            try {
                const response = await fetch(`${API_BASE}/payments/list?limit=50`);
                const result = await response.json();

                const tbody = document.getElementById('paymentsTableBody');
                if (result.payments && result.payments.length > 0) {
                    tbody.innerHTML = result.payments.map(p => `
                        <tr>
                            <td style="font-family: monospace; font-size: 0.85rem;">${p.payment_id.substring(0, 16)}...</td>
                            <td style="font-weight: 600;">${p.amount.toFixed(2)}</td>
                            <td>${p.currency}</td>
                            <td>${p.debtor_bank}</td>
                            <td>${p.creditor_bank}</td>
                            <td><span class="status-badge status-${p.status.toLowerCase()}">${p.status}</span></td>
                            <td>${new Date(p.created_at).toLocaleString()}</td>
                            <td>${p.estimated_time}</td>
                        </tr>
                    `).join('');
                } else {
                    tbody.innerHTML = '<tr><td colspan="8" style="text-align: center; padding: 2rem; color: #A0AEC0;">No payments found</td></tr>';
                }
            } catch (error) {
                console.error('Error loading payments:', error);
            }
        }

        // Load payments on page load
        window.addEventListener('load', loadPaymentsList);

        // Auto-refresh every 10 seconds
        setInterval(loadPaymentsList, 10000);
    </script>
</body>
</html>
